<% if(flash[:error]) %>
  <div class = "error-msg flash-message">
    <%= flash[:error] %>
  </div>
<% end %>

<% if(flash[:success]) %>
  <div class = "success-msg flash-message">
    <%= flash[:success] %>
  </div>
<% end %>

<div class = "menu">
  <div class = "main-section">
    <div class = "main-section-heading">
      <h2>Menu</h2>

      <% if @current_user && @current_user.role != "Billing clerk" && @page == "Menu" %>
        <% @styling = (@current_order != nil) ? "display: none;" : " " %>
        <%= form_with url: orders_path do |form| %>
          <%= form.submit "Create new order", style: "#{@styling}", class: "createorder-btn"%>
        <% end %>
      <% end %>
    </div>
    
    <% if @current_user.role == "Owner" && @page == "Change menu" %>
      <%= form_with url: menu_items_path, class: "add-item" do |form| %>
        <div class = "first-row">
          <%= form.text_field :name, placeholder: "Name" %>
          <%= form.number_field :price, placeholder: "Price" %>
          <%= form.select :menu_id, @options %>
        </div>

        <div class = "second-row">
          <%= form.text_area :description, placeholder: "Description" %>
          <%= form.submit "Add" %>
        </div>
      <% end %>
    <% end %>

    <div class = "menu-sections">
        <% @menus.each do |menu| %>
          <%= render partial: "menu-section", locals:{
            heading: menu.name,
            menuitems: menu.menu_items
          } %>
        <% end %>
    </div>
  </div>

  <% if @current_order && @orderitems.count > 0 %>
    <div class = "added-items" >
      <div class = "inside-added-items" > 
        <h3> Order Items </h3>

        <div class = "orderitems-container">
          <ul>
            <% @orderitems.each do |orderitem| %>
              <li>
                <div class = "order-item-name"> <%= orderitem.menu_item_name %> </div>
                <div class = "priceAndButton">
                  <p><i class="fas fa-rupee-sign"></i> <%= orderitem.menu_item_price %>  * <%= orderitem.quantity %> </p>
                  <%= form_with url: "/order_items/#{orderitem.id}", method: "delete" do |form| %>
                    <%= form.submit "Remove", class: "remove-orderitem" %>
                  <% end %>
                </div>
              </li>
            <% end %>
          </ul>
        </div>

        <div class = "buttons">
          <div class = "cancelorder">
            <%= form_with url: "/orders/#{@order_id}", method: "delete" do |form| %>
              <%= form.submit "Cancel Order", 
                class: "deleteorder-btn",
                disabled: @current_order == nil
              %>
            <% end %>
          </div>
          
          <div class = "checkout-container">
            <%= form_with url: checkouts_path, method: "get" do |form| %>
              <%= form.submit "Checkout", 
                class: "checkout-btn",
                disabled: @orderitems.count == 0
              %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>